<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Editor</title>

    <!-- Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/overlay.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/editor.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/root.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/mobile.css') }}" media="(max-width: 768px)">

    <!-- Icon -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/icon.png') }}">

    <!-- Noscript -->
    <noscript>
        <style>
        .hidden{display:none!important}
        .requires-js{display:none!important}
        </style>
    </noscript>
</head>
<body>
    <!-- ========================= HEADER ========================= -->
    <header>
        <img src="{{ url_for('static', filename='images/icon.png') }}" alt="Logo" class="logo">
        <h1>Overlay Editor</h1>
        <div class="header-controls">
            <div class="export-wrapper hidden">
                <input type="text" id="export-filename" placeholder="overlayname.json">
                <button class="btn primary export-confirm-btn" type="button">Save</button>
               <label class="toggle" title="Save exported template to server">
                    <span style="margin-left:.5rem;margin-right:.5rem;font-size:14px;">Save to server?</span>
                    <input id="save-to-server" type="checkbox" checked>
                    <span class="slider"><span></span></span>
                </label>
            </div>
            
            <button id="toggle-overlay-grid" class="btn" title="Toggle Overlay Grid" aria-pressed="true">ðŸ”²</button>
            <script>
                    (function(){
                        const btn = document.getElementById('toggle-overlay-grid');
                        if(!btn) return;
                        btn.addEventListener('click', function(){
                            const grid = document.getElementById('overlay-grid');
                            if(!grid) return;
                            const isHidden = grid.classList.toggle('hidden');
                            btn.setAttribute('aria-pressed', String(!isHidden));
                        });
                    })();
                </script>
            <div class="dropdown" style="position:relative;">
                <button id="appearance-dropdown-btn" class="btn" aria-haspopup="true" aria-expanded="false" title="Appearance options">
                    ðŸŽ¨
                </button>
                <div id="appearance-dropdown" class="hidden" role="menu" aria-labelledby="appearance-dropdown-btn">
                    <div class="dropdown-item">
                        <div class="dropdown-item-label">
                            <strong>Theme</strong>
                            <small>Dark mode</small>
                        </div>
                        <label class="toggle">
                            <input id="theme-switch" type="checkbox" checked>
                            <span class="slider"><span></span></span>
                        </label>
                    </div>
                </div>

                <button id="theme-toggle" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;" aria-pressed="false" title="Toggle Lyntr">Toggle Lyntr</button>
            </div>
            
            <button class="btn import-btn" title="Import template" aria-label="Import template">Import</button>
            <button class="btn export-btn" title="Export template" aria-label="Export template">Export</button>
            <button id="close-editor-btn" class="btn danger" title="Open overlay editor">&#128473</button>
            <script>
            (function(){
                const btn = document.getElementById('close-editor-btn');
                if(!btn) return;
                btn.addEventListener('click', function(){
                    try { window.close(); } catch(e) {}
                    try { window.open('', '_self'); window.close(); } catch(e) {}
                    window.location.href = 'about:blank';
                });
            })();
            </script>
        </div>
    </header>

  <!-- ========================= OVERLAY EDITOR ========================= -->
    <div class="overlay-editor">
        <div class="overlay-editor-content">
            <!-- Stage -->
            <div id="overlay-stage" class="overlay-stage">
                <!-- Grid -->
                <div id="overlay-grid" class="overlay-grid" role="presentation" aria-hidden="false" data-spacing="25" data-opacity="0.4"></div>
                <img id="overlay-image" src="{{ url_for('static', filename='images/Testpage.png') }}" alt="Overlay Preview" class="overlay-image" />
                <div id="overlay-layer" class="overlay-layer" aria-label="Overlay elements layer"></div>
            </div>

            <!-- Controls -->
            <div class="overlay-controls">
                <div class="form-row" style="display:flex;gap:.5rem;">
                <div class="form-group" style="flex:1">
                    <button class="btn primary add-text" type="button" style="width:100%;">Add Text</button>
                </div>
                <div class="form-group" style="flex:1">
                    <button class="btn secondary add-image" type="button" style="width:100%;">Add Image</button>
                </div>
                </div>

                <div class="form-group">
                <label for="text-content">Text</label>
                <input id="text-content" type="text" placeholder="Edit selected text" />
                </div>

                <div class="form-row">
                <div class="form-group" style="flex:1">
                    <label for="font-family">Font</label>
                    <select id="font-family">
                    <option value="'Minecraft', 'Minecraftia', system-ui, sans-serif">Minecraft</option>
                    <option value="Inter, system-ui, sans-serif">Inter</option>
                    <option value="Arial, Helvetica, sans-serif">Arial</option>
                    <option value="'Segoe UI', Tahoma, Geneva, Verdana, sans-serif">Segoe UI</option>
                    <option value="'Times New Roman', Times, serif">Times New Roman</option>
                    <option value="Georgia, serif">Georgia</option>
                    <option value="'Courier New', Courier, monospace">Courier New</option>
                    <option value="'Lucida Console', Monaco, monospace">Lucida Console</option>
                    <option value="'Comic Sans MS', cursive, sans-serif">Comic Sans MS</option>
                    <option value="Impact, Charcoal, sans-serif">Impact</option>
                    <option value="'Brush Script MT', cursive">Brush Script MT</option>
                    <option value="'Papyrus', fantasy">Papyrus</option>
                    <option value="Verdana, Geneva, sans-serif">Verdana</option>
                    </select>
                </div>

                <div class="form-group" style="width:110px">
                    <label for="font-size">Size</label>
                    <input id="font-size" type="number" min="8" max="300" step="1" value="24" />
                </div>
                </div>

                <div class="form-row">
                    <div class="form-group" style="flex:1">
                        <label>Text Color</label>
                        <div style="display:flex;gap:.5rem;align-items:center">
                        <input id="text-color" type="color" value="#ffffff" />
                        <input id="text-alpha" type="range" min="0" max="1" step="0.01" value="1" title="Text alpha" />
                        </div>
                    </div>

                    <div class="form-group" style="flex:1">
                        <label>Background</label>
                        <div style="display:flex;gap:.5rem;align-items:center">
                        <input id="bg-color" type="color" value="#000000" />
                        <input id="bg-alpha" type="range" min="0" max="1" step="0.01" value="0" title="Background alpha" />
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group" style="flex:1">
                        <label for="text-align">Align</label>
                        <select id="text-align">
                        <option value="left">Left</option>
                        <option value="center">Center</option>
                        <option value="right">Right</option>
                        </select>
                    </div>

                    <div class="form-group" style="flex:1">
                        <label for="rotation">Rotation</label>
                        <input id="rotation" type="range" min="0" max="180" step="15" value="0" />
                    </div>

                    <div class="form-group" style="flex:1">
                        <label for="opacity">Opacity</label>
                        <input id="opacity" type="range" min="0" max="1" step="0.05" value="1" />
                    </div>
                </div>

                <div class="form-row" style="gap:.5rem">
                    <div class="form-group" style="flex:1;display:flex;gap:.5rem">
                        <button id="toggle-bold" class="btn" title="Toggle bold"><strong>Bold</strong></button>
                        <button id="toggle-italic" class="btn" title="Toggle italic"><em>Italic</em></button>
                        <button id="toggle-underline" class="btn" title="Toggle underline"><u>Underline </u></button>
                    </div>

                    <div class="form-group" style="display:flex;gap:.5rem">
                        <button id="bring-forward" class="btn" title="Bring forward">Bring Forward</button>
                        <button id="send-backward" class="btn" title="Send backward">Send Backward</button>
                        <button id="delete-text" class="btn danger" title="Delete selected">Delete</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Templates Panel -->
    <div id="overlay-search-panel" class="overlay-search open">
        <button class="collapse-toggle" type="button" title="Collapse templates panel" aria-label="Collapse templates panel" aria-expanded="true"></button>
        <h3>Templates</h3>
        <ul class="overlay-templates-list">
            {% if overlay_templates %}
                {% for tpl in overlay_templates %}
                <li class="template-item" data-json="{{ url_for('static', filename='overlay-templates/' ~ tpl) }}">
                    <div class="template-preview" style="margin-bottom:.5rem;">
                    <div class="overlay-stage" style="position:relative; overflow:hidden;">
                        <img src="{{ url_for('static', filename='images/Testpage.png') }}" alt="Template preview" class="overlay-image" style="display:block; width:100%; height:auto;" />
                        <div class="overlay-layer" style="position:absolute; inset:0;"></div>
                    </div>
                    </div>

                    <a href="{{ url_for('static', filename='overlay-templates/' ~ tpl) }}" target="_blank" rel="noopener">{{ tpl }}</a>
                    <button class="btn small import-template" data-file="{{ tpl }}" title="Import template">Import</button>
                    <button class="btn small danger delete-template" data-file="{{ tpl }}" title="Delete template">Delete</button>
                </li>
                {% endfor %}
            {% else %}
                <li class="empty">No templates found!</li>
            {% endif %}
        </ul>
    </div>

    <!-- Assets Panel -->
    <div id="assets-panel" class="assets-panel open">
        <button class="assets-collapse-toggle" type="button" title="Collapse assets panel" aria-label="Collapse assets panel" aria-expanded="true"></button>
        <h3>Assets</h3>
        <ul class="overlay-assets-list">
        {% if overlay_assets %}
            {% for asset in overlay_assets %}
            <li class="asset-item">
                <img src="{{ url_for('static', filename='overlay-assets/' ~ asset) }}"
                    alt="{{ asset }}"
                    class="asset-image"
                    style="display:block;width:100%;height:auto;object-fit:contain;background:#111;padding:.25rem;border:1px solid #222;border-radius:4px;"
                    loading="lazy">
                <small style="display:block;word-break:break-all;margin-top:.35rem;font-size:.7rem;opacity:.7;">
                {{ asset }}
                </small>

                <div style="margin-top:.5rem;display:flex;gap:.5rem;flex-wrap:wrap;">
                <button class="btn small import-asset" data-file="{{ asset }}" title="Import asset">Import</button>
                <button class="btn small danger delete-asset" data-file="{{ asset }}" title="Delete asset">Delete</button>
                </div>
            </li>
            {% endfor %}
        {% else %}
            <li class="empty">No assets found!</li>
        {% endif %}
        </ul>
    </div>

    <!-- ========================= KEYBOARD SHORTCUTS ========================= -->
    <button id="open-shortcuts" class="btn" style="position:fixed;right:1rem;bottom:1rem;z-index:9999;" title="Keyboard shortcuts help" aria-haspopup="dialog" aria-controls="shortcuts-dialog">?</button>
    
    <div id="shortcuts-dialog" class="hidden" role="dialog" aria-modal="true" aria-labelledby="shortcuts-title">
        <div class="dialog-content">
            <h2 id="shortcuts-title">Overlay Editor Shortcuts</h2>
            <p>Hold Shift for larger movement where noted.</p>

            <div class="shortcuts-grid">
                <div><strong>Esc</strong><br><span style="opacity:.7;">Deselect element</span></div>
                <div><strong>Delete / Backspace</strong><br><span style="opacity:.7;">Remove selected element</span></div>
                <div><strong>Arrow Keys</strong><br><span style="opacity:.7;">Move 1px (Shift = 10px)</span></div>
                <div><strong>Ctrl / Cmd + Arrow Up</strong><br><span style="opacity:.7;">Bring forward (z-order +1)</span></div>
                <div><strong>Ctrl / Cmd + Arrow Down</strong><br><span style="opacity:.7;">Send backward (z-order -1)</span></div>
                <div><strong>Alt + S</strong><br><span style="opacity:.7;">Export / Save JSON</span></div>
                <div><strong>Alt + T</strong><br><span style="opacity:.7;">Add text element</span></div>
                <div><strong>Alt + I</strong><br><span style="opacity:.7;">Add / pick image</span></div>
                <div><strong>Alt + D</strong><br><span style="opacity:.7;">Duplicate selected</span></div>
                <div><strong>Alt + B</strong><br><span style="opacity:.7;">Toggle bold</span></div>
                <div><strong>Alt + Shift + I</strong><br><span style="opacity:.7;">Toggle italic</span></div>
                <div><strong>Alt + U</strong><br><span style="opacity:.7;">Toggle underline</span></div>
            </div>

            <button type="button" aria-label="Close" id="shortcuts-x" style="position:absolute;top:.4rem;right:.55rem;background:none;border:0;color:inherit;font-size:1.1rem;line-height:1;cursor:pointer;">Ã—</button>
        </div>
    </div>

    <!-- ========================= FOOTER ========================= -->
    <footer class="site-footer" role="contentinfo" style="padding:0.75rem 1rem;text-align:center;font-size:.85rem;color:var(--muted,#999);bottom:10px;">
        <small>Website by <strong>nino.css</strong> Â· API by <strong>Hasenzahn1</strong></small>
    </footer>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='scripts/core/app.js') }}" defer></script>
    <script src="{{ url_for('static', filename='scripts/ui/appearance.js') }}" defer></script>
    <script src="{{ url_for('static', filename='scripts/ui/shortcuts.js') }}" defer></script>
    <script src="{{ url_for('static', filename='scripts/overlay/modal.js') }}" defer></script>
    <script src="{{ url_for('static', filename='scripts/overlay/editor.js') }}" defer></script>
    <script src="{{ url_for('static', filename='scripts/overlay/panel.js') }}" defer></script>
</body>
</html>
